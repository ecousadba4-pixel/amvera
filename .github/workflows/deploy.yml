name: Deploy Loyalty API

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Execute deployment commands on VPS
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.VPS_SSH_KEY }}
          port: 22
          script: |
            echo "üì¶ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞"
            cd /home/apps/loyalty-api

            echo "üîÑ –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥"
            git pull

            echo "üìö –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏"
            npm install --production

            echo "üöÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å"
            sudo systemctl restart loyalty-api.service

            echo "‚úÖ –ì–æ—Ç–æ–≤–æ! Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω."
